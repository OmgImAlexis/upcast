<!DOCTYPE html>
<html>
<head>

    <meta charset="utf-8"/>
    <title>Upcast Test Runner (Legacy Browsers)</title>

    <style>
        .pass {
            color: #090;
        }
        .fail {
            color: #c00;
        }
    </style>

</head>
<body>

    <p>
        Unfortunately, my test tools don't work in IE 6â€“8 and Firefox 3.6.<br/>
        This file just runs some basic integration-type tests for those browsers.<br/>
        See <a href="https://github.com/chaijs/chai/issues/117">this issue</a>.
    </p>

    <ul id="results"></ul>

    <!-- Dependencies and basic runner -->
    <script src="json3.min.js"></script>
    <script src="index.js"></script>
    <script>
        var results = document.getElementById('results');
        function assert (value, msg) {
            results.innerHTML += [
                '<li class="', (value ? 'pass' : 'fail'), '">',
                    msg,
                '</li>'
            ].join('');
        }
    </script>

    <!-- Tests -->
    <script>

        // Basics
        assert(typeof upcast.type === 'function', 'upcast.type is accessible');
        assert(typeof upcast.is === 'function', 'upcast.is is accessible');
        assert(typeof upcast.to === 'function', 'upcast.to is accessible');

        // Type
        assert(upcast.type([1, 2, 3]) === 'array', 'upcast.type reports array correctly');
        assert(upcast.type(true) === 'boolean', 'upcast.type reports boolean correctly');
        assert(upcast.type(function () {}) === 'function', 'upcast.type reports function correctly');
        assert(upcast.type(null) === 'null', 'upcast.type reports null correctly');
        assert(upcast.type(12) === 'number', 'upcast.type reports number correctly');
        assert(upcast.type(NaN) === 'number', 'upcast.type reports NaN correctly');
        assert(upcast.type(Infinity) === 'number', 'upcast.type reports Infinity correctly');
        assert(upcast.type({}) === 'object', 'upcast.type reports object correctly');
        assert(upcast.type('foo') === 'string', 'upcast.type reports string correctly');
        assert(upcast.type(undefined) === 'undefined', 'upcast.type reports undefined correctly');

        // Is
        assert(upcast.is([1, 2, 3], 'array') === true, 'upcast.is checks array correctly');
        assert(upcast.is(true, 'boolean') === true, 'upcast.is checks boolean correctly');
        assert(upcast.is(function () {}, 'function') === true, 'upcast.is checks function correctly');
        assert(upcast.is(null, 'null') === true, 'upcast.is checks null correctly');
        assert(upcast.is(12, 'number') === true, 'upcast.is checks number correctly');
        assert(upcast.is({}, 'object') === true, 'upcast.is checks object correctly');
        assert(upcast.is('foo', 'string') === true, 'upcast.is checks string correctly');
        assert(upcast.is(undefined, 'undefined') === true, 'upcast.is checks undefined correctly');
        assert(upcast.is(undefined, 'array') === false, 'upcast.is checks non-array correctly');
        assert(upcast.is([1, 2, 3], 'boolean') === false, 'upcast.is checks non-boolean correctly');
        assert(upcast.is(true, 'function') === false, 'upcast.is checks non-function correctly');
        assert(upcast.is(function () {}, 'null') === false, 'upcast.is checks non-null correctly');
        assert(upcast.is(null, 'number') === false, 'upcast.is checks non-number correctly');
        assert(upcast.is(12, 'object') === false, 'upcast.is checks non-object correctly');
        assert(upcast.is({}, 'string') === false, 'upcast.is checks non-string correctly');
        assert(upcast.is('foo', 'undefined') === false, 'upcast.is checks defined correctly');

        // To helpers

        var testFn = function () {};
        testFn.foo = 'bar';

        function testTo (desc, type, pairs) {
            var i, len = pairs.length, pair;
            for (i = 0; i < len; i ++) {
                pair = pairs[i];
                assert((JSON.stringify(upcast.to(pair.from, type)) === JSON.stringify(pair.to)), desc + ' (from ' + upcast.type(pair.from) + ')');
            }
        }

        function testToFn (desc, pairs) {
            var i, len = pairs.length, pair;
            for (i = 0; i < len; i ++) {
                pair = pairs[i];
                assert((JSON.stringify(upcast.to(pair, 'function')()) === JSON.stringify(pair)), desc + ' (from ' + upcast.type(pair) + ')');
            }
        }

        // To

        testTo('upcast.to converts to array correctly', 'array', [
            { from: ['a', 'b', 'c'], to: ['a', 'b', 'c'] },
            { from: [1, 2, 3],       to: [1, 2, 3] },
            { from: [],              to: [] },
            { from: true,            to: [true] },
            { from: false,           to: [false] },
            { from: testFn,          to: [testFn] },
            { from: null,            to: [] },
            { from: 123,             to: [123] },
            { from: NaN,             to: [NaN] },
            { from: Infinity,        to: [Infinity] },
            { from: {foo: 'bar'},    to: [{foo: 'bar'}] },
            { from: 'foo',           to: ['f', 'o', 'o'] },
            { from: '',              to: [] },
            { from: undefined,       to: [] }
        ]);

        testTo('upcast.to converts to boolean correctly', 'boolean', [
            { from: ['a', 'b', 'c'], to: true },
            { from: [1, 2, 3],       to: true },
            { from: [],              to: false },
            { from: true,            to: true },
            { from: false,           to: false },
            { from: testFn,          to: true },
            { from: null,            to: false },
            { from: 123,             to: true },
            { from: 0,               to: false },
            { from: NaN,             to: false },
            { from: Infinity,        to: true },
            { from: {foo: 'bar'},    to: true },
            { from: 'foo',           to: true },
            { from: '',              to: false },
            { from: undefined,       to: false }
        ]);

        testToFn('upcast.to converts to function correctly', [
            ['a', 'b', 'c'],
            [1, 2, 3],
            [],
            true,
            false,
            null,
            123,
            0,
            NaN,
            Infinity,
            {foo: 'bar'},
            'foo',
            '',
            undefined
        ]);

        testTo('upcast.to converts to null correctly', 'null', [
            { from: ['a', 'b', 'c'], to: null },
            { from: [1, 2, 3],       to: null },
            { from: [],              to: null },
            { from: true,            to: null },
            { from: false,           to: null },
            { from: testFn,          to: null },
            { from: null,            to: null },
            { from: 123,             to: null },
            { from: 0,               to: null },
            { from: NaN,             to: null },
            { from: Infinity,        to: null },
            { from: {foo: 'bar'},    to: null },
            { from: 'foo',           to: null },
            { from: '',              to: null },
            { from: undefined,       to: null }
        ]);

        testTo('upcast.to converts to number correctly', 'number', [
            { from: ['a', 'b', 'c'], to: 0 },
            { from: [1, 2, 3],       to: 123 },
            { from: [],              to: 0 },
            { from: true,            to: 1 },
            { from: false,           to: 0 },
            { from: testFn,          to: NaN },
            { from: null,            to: 0 },
            { from: 123,             to: 123 },
            { from: NaN,             to: NaN },
            { from: Infinity,        to: Infinity },
            { from: {foo: 'bar'},    to: NaN },
            { from: 'foo',           to: 0 },
            { from: '',              to: 0 },
            { from: undefined,       to: 0 }
        ]);

        testTo('upcast.to converts to object correctly', 'object', [
            { from: ['a', 'b', 'c'], to: ['a', 'b', 'c'] },
            { from: [1, 2, 3],       to: [1, 2, 3] },
            { from: [],              to: [] },
            { from: true,            to: true },
            { from: false,           to: false },
            { from: testFn,          to: testFn },
            { from: null,            to: {} },
            { from: 123,             to: 123 },
            { from: NaN,             to: NaN },
            { from: Infinity,        to: Infinity },
            { from: {foo: 'bar'},    to: {foo: 'bar'} },
            { from: 'foo',           to: 'foo' },
            { from: '',              to: '' },
            { from: undefined,       to: {} }
        ]);

        testTo('upcast.to converts to string correctly', 'string', [
            { from: ['a', 'b', 'c'], to: 'abc' },
            { from: [1, 2, 3],       to: '123' },
            { from: [],              to: '' },
            { from: true,            to: 'true' },
            { from: false,           to: 'false' },
            { from: null,            to: '' },
            { from: 123,             to: '123' },
            { from: NaN,             to: 'NaN' },
            { from: Infinity,        to: 'Infinity' },
            { from: {foo: 'bar'},    to: '[object Object]' },
            { from: 'foo',           to: 'foo' },
            { from: '',              to: '' },
            { from: undefined,       to: '' }
        ]);
        assert(/function/.test(JSON.stringify(upcast.to(function () {}, 'string'))), 'upcast.to converts to string correctly (from function)');

        testTo('upcast.to converts to undefined correctly', 'undefined', [
            { from: ['a', 'b', 'c'], to: undefined },
            { from: [1, 2, 3],       to: undefined },
            { from: [],              to: undefined },
            { from: true,            to: undefined },
            { from: false,           to: undefined },
            { from: testFn,          to: undefined },
            { from: null,            to: undefined },
            { from: 123,             to: undefined },
            { from: 0,               to: undefined },
            { from: NaN,             to: undefined },
            { from: Infinity,        to: undefined },
            { from: {foo: 'bar'},    to: undefined },
            { from: 'foo',           to: undefined },
            { from: '',              to: undefined },
            { from: undefined,       to: undefined }
        ]);

    </script>

</body>
</html>